<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INBDE Practice Exam</title>
    <style>
        /* --- General Styles --- */
        :root {
            --primary-color: #005f73;
            --primary-dark: #003049;
            --light-bg: #f4f7f6;
            --white: #ffffff;
            --border-color: #dee2e6;
            --correct-bg: #e6fcf5;
            --correct-border: #b7e9d7;
            --incorrect-bg: #fff5f5;
            --incorrect-border: #ffd6d6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--light-bg);
            color: #333;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        /* --- Main Container --- */
        .quiz-container {
            max-width: 800px;
            margin: 20px auto;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        /* --- Header --- */
        header {
            padding: 20px 30px;
            background-color: var(--primary-color);
            color: var(--white);
            border-bottom: 1px solid var(--primary-dark);
        }
        header h1 {
            margin: 0;
            font-size: 1.6em;
        }
        #progressText {
            margin: 5px 0 0;
            font-size: 1em;
            opacity: 0.9;
            font-weight: 600;
        }

        /* --- Quiz Body --- */
        #quizBody {
            padding: 30px;
        }
        .question-title {
            font-weight: 600;
            font-size: 1.15em;
            margin-bottom: 20px;
            color: var(--primary-dark);
        }
        
        /* --- Options (Radio Buttons) --- */
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .options label {
            display: block;
            padding: 12px 15px;
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .options label:hover {
            background-color: #e9ecef;
        }
        .options input[type="radio"] {
            /* Hidden but accessible */
            opacity: 0;
            width: 0;
            height: 0;
            position: absolute;
        }
        .options label span {
            display: inline-block;
            margin-left: 5px;
        }
        /* Style for selected option */
        .options label:has(input[type="radio"]:checked) {
            border-color: var(--primary-color);
            background-color: #e6f7ff;
            box-shadow: 0 0 0 2px rgba(0, 95, 115, 0.2);
        }

        /* --- Footer & Button --- */
        .quiz-footer {
            padding: 20px 30px;
            background-color: #fdfdfd;
            border-top: 1px solid #f0f0f0;
            text-align: right;
        }
        #nextBtn {
            display: inline-block;
            padding: 12px 30px;
            font-size: 1.1em;
            font-weight: 600;
            color: white;
            background-color: #0077b6;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        #nextBtn:hover {
            background-color: #005a8d;
        }

        /* --- Results Page --- */
        #resultsPage {
            padding: 10px;
        }
        .score-summary {
            text-align: center;
            padding: 30px;
            background: var(--primary-dark);
            color: var(--white);
        }
        .score-summary h2 {
            margin: 0;
            font-size: 2.5em;
        }
        .result-item {
            border-bottom: 1px solid var(--border-color);
            padding: 20px;
        }
        .result-item .question-title {
            font-size: 1.1em;
            color: #333;
        }
        .result-item p {
            margin: 5px 0;
        }
        .explanation {
            background: #f8f9fa;
            border-left: 4px solid #0077b6;
            padding: 10px 15px;
            margin-top: 15px;
            font-size: 0.95em;
        }
        /* Styles for Correct/Incorrect */
        .result-item.correct {
            background-color: var(--correct-bg);
            border-left: 5px solid #2a9d8f;
        }
        .result-item.incorrect {
            background-color: var(--incorrect-bg);
            border-left: 5px solid #e76f51;
        }
        .result-item h3 {
            margin: 0 0 10px;
            font-size: 1.2em;
        }
        .result-item.correct h3 {
            color: #2a9d8f;
        }
        .result-item.incorrect h3 {
            color: #e76f51;
        }
        .answer-key {
            font-weight: 600;
        }

        .hidden {
            display: none;
        }
        
        /* --- Responsive Styles (Mobile) --- */
        @media (max-width: 600px) {
            body {
                background-color: var(--white);
            }
            .quiz-container {
                margin: 0;
                border-radius: 0;
                box-shadow: none;
                width: 100%;
            }
            header {
                padding: 20px;
                border-radius: 0;
            }
            header h1 {
                font-size: 1.4em;
            }
            #quizBody, .quiz-footer {
                padding: 20px;
            }
            #resultsPage {
                padding: 0;
            }
            .result-item {
                padding: 15px;
            }
        }
    </style>
</head>
<body>

    <div class="quiz-container">
        <header>
            <h1>INBDE Practice Exam</h1>
            <p id="progressText">Loading...</p>
        </header>
        
        <div id="quizBody"></div>

        <div class="quiz-footer">
            <button id="nextBtn">Next</button>
        </div>

        <div id="resultsPage" class="hidden">
            </div>

    </div>

    <script>
        // --- Data Source: Questions, Options, and Explanations ---
        const quizData = [
            {
                question: "A 68-year-old male with end-stage renal disease (ESRD) presents for emergency extraction of tooth #30. His nephrologist confirms a GFR of 8 mL/min. Which analgesic and antibiotic regimen, if prescribed without modification, poses the LEAST iatrogenic risk?",
                options: [
                    { text: "Ibuprofen 800mg and Tetracycline 500mg", value: "a" },
                    { text: "Acetaminophen 500mg and Amoxicillin 500mg", value: "b" },
                    { text: "Diclofenac 50mg and Metronidazole 500mg", value: "c" },
                    { text: "Naproxen 500mg and Acyclovir 400mg", value: "d" },
                    { text: "Codeine 30mg and Doxycycline 100mg", value: "e" }
                ],
                correct: "e",
                explanation: "With a GFR < 10 mL/min, NSAIDs (Ibuprofen, Diclofenac, Naproxen) must be avoided as they are nephrotoxic. Antibiotics with renal elimination like Amoxicillin, Tetracycline, and Acyclovir must also be avoided or adjusted. Doxycycline is primarily eliminated hepatically and Codeine is considered safe, making this the lowest-risk option."
            },
            {
                question: "A patient with chronic renal failure awaiting transplantation presents for a consultation. Clinical examination reveals pale mucosa, gingival petechiae, and significant lingual erosion. Radiographs show decreased trabeculation and partial pulp obliteration. Which of the following findings would be INCONSISTENT with the patient's systemic condition?",
                options: [
                    { text: "Uremic stomatitis with painful hyperkeratotic lesions.", value: "a" },
                    { text: "A high prevalence of rampant smooth-surface caries.", value: "b" },
                    { text: "Gingival hyperplasia secondary to immunosuppressive therapy.", value: "c" },
                    { text: "Xerostomia attributed to polypharmacy and fluid restriction.", value: "d" },
                    { text: "Soft tissue radiolucencies consistent with renal osteodystrophy.", value: "e" }
                ],
                correct: "b",
                explanation: "Uremia has a bacteriostatic and buffering effect (due to urea in the saliva), which paradoxically DECREASES the risk of caries in patients with renal failure. All other findings (stomatitis, cyclosporine-induced hyperplasia, xerostomia, and renal osteodystrophy) are classic oral manifestations."
            },
            {
                question: "A dental patient's medical history update reveals a recent blood creatinine level of 4.5 mg/dl. Based on the provided staging, what is the most probable clinical status and corresponding creatinine clearance range for this individual?",
                options: [
                    { text: "Normal function; 90-120 mL/min", value: "a" },
                    { text: "Renal compensation; >45-60 mL/min", value: "b" },
                    { text: "Onset of clinical features; 20-60 mL/min", value: "c" },
                    { text: "Established clinical disease; 10-25 mL/min", value: "d" },
                    { text: "Dialysis required; <10 mL/min", value: "e" }
                ],
                correct: "d",
                explanation: "According to the document's table, a blood creatinine level between 2.5-10 mg/dl corresponds to 'Established clinical disease', which has a creatinine clearance of 10-25 mL/min. 4.5 mg/dl falls within this range."
            },
            {
                question: "A patient who received a renal transplant 7 years prior is on a stable regimen of cyclosporine and prednisone. Which of the following oral findings is LEAST likely to be directly associated with the patient's post-transplant medical management?",
                options: [
                    { text: "Gingival hyperplasia", value: "a" },
                    { text: "Oral hairy leukoplakia", value: "b" },
                    { text: "Kaposi's sarcoma", value: "c" },
                    { text: "Enamel hypoplasia", value: "d" },
                    { text: "Candidiasis", value: "e" }
                ],
                correct: "d",
                explanation: "Enamel hypoplasia is a developmental defect that occurs while the tooth is forming. It cannot be caused by medications in a post-transplant adult. Gingival hyperplasia (from cyclosporine) and opportunistic infections (oral hairy leukoplakia, sarcoma, candidiasis) are known risks of immunosuppression."
            },
            {
                question: "A clinician is managing a hospitalized patient for a DVT. The patient was initially started on an IV anticoagulant that monitors the intrinsic pathway and has a rapid onset. The plan is to transition to an oral anticoagulant that is teratogenic and monitored via the extrinsic pathway. Which drug combination represents this transition?",
                options: [
                    { text: "Initial: Warfarin; Transition: Heparin", value: "a" },
                    { text: "Initial: Heparin; Transition: Warfarin", value: "b" },
                    { text: "Initial: Clopidogrel; Transition: Dabigatran", value: "c" },
                    { text: "Initial: Rivaroxaban; Transition: Apixaban", value: "d" },
                    { text: "Initial: Protamine; Transition: Vitamin K", value: "e" }
                ],
                correct: "b",
                explanation: "Heparin is IV, has a rapid onset, and affects the intrinsic pathway (monitored by aPTT). Warfarin is oral, has a slow onset, is teratogenic, and affects the extrinsic pathway (monitored by PT/INR). This is the classic 'bridge therapy'."
            },
            {
                question: "A 55-year-old patient on chronic warfarin therapy for atrial fibrillation requires extraction of tooth #14. His INR, measured 24 hours prior, is 2.7. Which of the following constitutes the LEAST appropriate management strategy according to current ADA and AAOM recommendations?",
                options: [
                    { text: "Proceeding with the extraction using local hemostatic measures.", value: "a" },
                    { text: "Instructing the patient to discontinue warfarin 3 days prior to the procedure.", value: "b" },
                    { text: "Prescribing acetaminophen for post-operative pain control.", value: "c" },
                    { text: "Administering local anesthetic with a vasoconstrictor via infiltration.", value: "d" },
                    { text: "Consulting the patient's physician, but not altering the warfarin dose.", value: "e" }
                ],
                correct: "b",
                explanation: "An INR of 2.7 is within the therapeutic range (2.0-3.5) for dental procedures. ADA and AAOM guidelines explicitly state NOT to discontinue warfarin, as the risk of a thromboembolic event (e.g., stroke) outweighs the risk of dental bleeding, which can be managed with local measures."
            },
            {
                question: "A patient with a stable therapeutic INR of 2.5 on warfarin is diagnosed with a dental abscess. The dentist prescribes an antibiotic and the patient self-medicates. One week later, the patient's INR is dangerously elevated to 5.2. Which combination of medications FAILS to explain this potentiation?",
                options: [
                    { text: "Erythromycin and acute ethanol consumption.", value: "a" },
                    { text: "Ciprofloxacin and omeprazole.", value: "b" },
                    { text: "Metronidazole and acetaminophen.", value: "c" },
                    { text: "Sulphonamides and disulfiram.", value: "d" },
                    { text: "Rifampicin and chronic ethanol consumption.", value: "e" }
                ],
                correct: "e",
                explanation: "The question asks for the combination that does NOT increase (potentiate) the INR. Rifampicin (and chronic alcohol use) is a potent P450 enzyme inducer ('CRAP BARS'). This accelerates warfarin metabolism, DECREASING its effect and lowering the INR. The other options are enzyme inhibitors ('O DEVICES') that potentiate warfarin."
            },
            {
                question: "A patient taking Apixaban (Eliquis) for DVT prevention requires a single-tooth implant placement. Which of the following management plans is most consistent with the provided guidelines for direct-acting oral anticoagulants (DOACs)?",
                options: [
                    { text: "Discontinue Apixaban 5 days prior to surgery.", value: "a" },
                    { text: "Bridge the patient with low molecular weight heparin.", value: "b" },
                    { text: "Proceed with the implant positioning without altering the Apixaban regimen.", value: "c" },
                    { text: "Admit the patient for surgery and have Vitamin K on standby.", value: "d" },
                    { text: "Double the Apixaban dose 24 hours post-operatively to compensate.", value: "e" }
                ],
                correct: "c",
                explanation: "For low-risk dental procedures (such as 1-3 extractions or implant placement), guidelines indicate that DOACs (like Apixaban) do not need to be discontinued or modified, provided local hemostatic measures are used."
            },
            {
                question: "A patient presents with a non-healing extraction socket 10 weeks post-operatively. The patient has a history of IV Zoledronic acid for bone metastases. A panoramic radiograph confirms exposed, necrotic bone. Which additional finding is REQUIRED to confirm a diagnosis of MRONJ?",
                options: [
                    { text: "A history of concurrent chemotherapy.", value: "a" },
                    { text: "Evidence of infection or fistula.", value: "b" },
                    { text: "An absence of radiation therapy to the maxillofacial region.", value: "c" },
                    { text: "Exposure to an oral bisphosphonate for less than 4 years.", value: "d" },
                    { text: "A pathologic fracture of the inferior border.", value: "e" }
                ],
                correct: "c",
                explanation: "The AAOMS 2022 definition of MRONJ has 3 criteria: 1) Current or previous treatment with antiresorptive agents, 2) Exposed bone persistent for more than 8 weeks, and 3) No history of radiation therapy to the jaws. If there were radiation history, the diagnosis would be Osteoradionecrosis (ORN)."
            },
            {
                question: "A patient on oral Alendronate for 6 years presents with dull, aching pain in the right mandible and loosening of tooth #29, not explained by periodontal disease. There is no visible exposed bone or fistula. Radiographs show localized osteosclerosis and obscuring of the PDL space. This clinical presentation is most consistent with:",
                options: [
                    { text: "MRONJ Stage 1", value: "a" },
                    { text: "MRONJ Stage 2", value: "b" },
                    { text: "MRONJ Stage 0 (Nonexposed bone variant)", value: "c" },
                    { text: "MRONJ Stage 3", value: "d" },
                    { text: "Osteoradionecrosis", value: "e" }
                ],
                correct: "c",
                explanation: "The AAOMS defines MRONJ Stage 0 (nonexposed bone variant) as the presence of non-specific symptoms (like dull pain or odontalgia) and radiographic findings (like sclerosis or thickening of the lamina dura) in a patient at risk, but WITHOUT any visible exposed bone or fistula."
            },
            {
                question: "A patient is diagnosed with MRONJ Stage 2. According to the non-operative treatment flowchart, which therapeutic modality is introduced at this stage that is NOT indicated for Stage 1?",
                options: [
                    { text: "Removal of mobile sequestrum.", value: "a" },
                    { text: "Local wound care to exposed bone.", value: "b" },
                    { text: "Segmental resection of the mandible.", value: "c" },
                    { text: "Systemic antibiotics and pain control.", value: "d" },
                    { text: "Antimicrobial rinses.", value: "e" }
                ],
                correct: "d",
                explanation: "Stage 1 is defined as exposed bone that is asymptomatic and has no evidence of infection. Stage 2 is defined as exposed bone WITH evidence of infection and/or symptoms (pain). Therefore, the non-operative management for Stage 2 adds systemic antibiotics and pain control, which are not indicated for Stage 1."
            },
            {
                question: "A 72-year-old female is scheduled for multiple extractions. Her medical history is significant for osteoporosis, for which she received an IV infusion of Zoledronic acid (Reclast) 11 months ago. Which statement INACCURATELY reflects the 2022 AAOMS guidelines regarding her management?",
                options: [
                    { text: "A drug holiday is not indicated as she is taking the drug for osteoporosis, not cancer.", value: "a" },
                    { text: "The patient is at risk for MRONJ.", value: "b" },
                    { text: "The benefit of a drug holiday for patients receiving antiresorptive therapy for cancer is unsubstantiated.", value: "c" },
                    { text: "If the patient were on Denosumab, surgery would be timed 3-4 months after the last dose.", value: "d" },
                    { text: "If she had been on oral Alendronate for >4 years, a 3-4 month holiday prior to surgery would be considered.", value: "e" }
                ],
                correct: "a",
                explanation: "This statement is inaccurate. While the risk is lower than for cancer patients, osteoporosis patients on antiresorptives (especially IV, like Reclast) ARE at risk. The AAOMS guidelines do suggest a 'drug holiday' for patients on oral bisphosphonates for >4 years and timing surgery based on the dosing schedule for agents like Denosumab. The benefit of a holiday for cancer patients, however, is unsubstantiated."
            },
            {
                question: "A patient receiving bolus-dose 5-Fluorouracil chemotherapy presents with severe, painful oral ulcerations 5 days after their first infusion. Which of the following statements regarding their condition is LEAST accurate?",
                options: [
                    { text: "The condition is termed oral mucositis and is characterized by epithelial disruption.", value: "a" },
                    { text: "The lesions are expected to resolve 2-4 weeks after the completion of the entire chemotherapy course.", value: "b" },
                    { text: "The chemotherapeutic agent, 5-Fluorouracil, is known to be highly associated with this reaction.", value: "c" },
                    { text: "Palliative management includes vigorous use of chlorhexidine or alcohol-based mouthrinses.", value: "d" },
                    { text: "Prophylactic use of oral cryotherapy during the infusion may reduce the severity of this condition.", value: "e" }
                ],
                correct: "d",
                explanation: "This statement is the least accurate. Alcohol-based mouthrinses are irritating and should be avoided in patients with oral mucositis. Palliative management focuses on bland rinses, like saline or sodium bicarbonate, and maintaining oral hygiene. Chlorhexidine use is also often not recommended due to its alcohol content and irritation potential."
            },
            {
                question: "A patient undergoing chemotherapy presents for an emergency dental visit. Which of the following clinical findings is NOT a recognized direct or indirect sequela of their antineoplastic therapy?",
                options: [
                    { text: "Oral candidiasis secondary to neutropenia.", value: "a" },
                    { text: "Herpetic lesions secondary to immunosuppression.", value: "b" },
                    { text: "Bilateral, reticular, white striae on the buccal mucosa consistent with a lichenoid reaction.", value: "c" },
                    { text: "Spontaneous gingival bleeding secondary to thrombocytopenia.", value: "d" },
                    { text: "Accelerated dental caries due to the cytotoxic effect on enamel.", value: "e" }
                ],
                correct: "e",
                explanation: "Chemotherapy does not have a direct cytotoxic effect on mature, formed enamel. All other findings are common sequelae: opportunistic infections (candidiasis, herpes) due to neutropenia/immunosuppression, mucosal reactions (lichenoid), and bleeding issues (thrombocytopenia)."
            },
            {
                question: "A patient with a severe, documented allergy to nuts and penicillin experiences syncope, wheezing, and urticaria 3 minutes after a dental procedure. This reaction is initiated by antigen cross-linking of which antibody class on the surface of mast cells?",
                options: [
                    { text: "IgA", value: "a" },
                    { text: "IgD", value: "b" },
                    { text: "IgE", value: "c" },
                    { text:D: "IgG", value: "d" },
                    { text: "IgM", value: "e" }
                ],
                correct: "c",
                explanation: "The described reaction is anaphylaxis, the most severe manifestation of Type I (Immediate) Hypersensitivity. This reaction is mediated by antigens cross-linking IgE antibodies on the surface of mast cells and basophils, causing degranulation."
            },
            {
                question: "A Type II hypersensitivity reaction, such as an ABO blood transfusion incompatibility, is immunologically distinct from a Type III reaction because the Type II reaction involves:",
                options: [
                    { text: "Antibody-antigen complexes depositing in tissues.", value: "a" },
                    { text: "IgE-mediated degranulation of basophils.", value: "b" },
                    { text: "Antibodies (IgG/IgM) directed against cell-surface antigens.", value: "c" },
                    { text: "A T-cell-mediated delayed inflammatory response.", value: "d" },
                    { text: "The release of leukotrienes and prostaglandins as primary mediators.", value:E: "e" }
                ],
                correct: "c",
                explanation: "Type II (Cytotoxic) Hypersensitivity involves antibodies (IgG or IgM) directed against antigens that are FIXED on a cell surface (e.g., a red blood cell). Type III is caused by SOLUBLE antigen-antibody complexes that deposit in tissues."
            },
            {
                question: "A patient develops vasculitis, fever, and glomerulonephritis 10 days after receiving a vaccination. This systemic reaction, best characterized as serum sickness, is mediated by which pathogenic mechanism?",
                options: [
                    { text: "Deposition of circulating antigen-antibody complexes in tissues.", value: "a" },
                    { text: "Cytokine release from sensitized TH1 cells activating macrophages.", value: "b" },
                    { text: "Direct cytotoxic T-cell (CTL) killing of normal tissue.", value: "c" },
                    { text: "Antibody-mediated cellular dysfunction (agonistic/antagonistic).", value: "d" },
                    { text: "Histamine release from IgE-coated mast cells.", value: "e" }
                ],
                correct: "a",
                explanation: "Serum sickness is the classic example of a systemic Type III Hypersensitivity reaction. It is caused by the deposition of circulating antigen-antibody (immune) complexes in tissues, leading to complement activation and inflammation (e.g., vasculitis, glomerulonephritis)."
            },
            {
                question: "A dental assistant presents with an erythematous, vesicular rash on their hands 48 hours after wearing a new brand of gloves. This reaction, which is not associated with urticaria or respiratory distress, is most likely mediated by:",
                options: [
                    { text: "TH1 cells and activated macrophages.", value: "a" },
                    { text: "IgG antibodies against cell surface antigens.", value: "b" },
                    { text: "Immune complex deposition in dermal blood vessels.", value: "c" },
                    { text: "IgE-mediated degranulation.", value: "d" },
                    { text: "B-cell activation via TH2 cells.", value: "e" }
                ],
                correct: "a",
                explanation: "A delayed reaction (48 hours) manifesting as contact dermatitis is the classic example of Type IV (Delayed-Type) Hypersensitivity. This reaction is not mediated by antibodies but by T-cells (specifically sensitized TH1 cells) releasing cytokines that activate macrophages."
            },
            {
                question: "During an immediate (Type I) hypersensitivity reaction, which of the following mediators is NOT considered a primary, pre-formed component released from mast cell granules, but is instead synthesized *after* cell activation?",
                options: [
                    { text: "Histamine", value: "a" },
                    { text: "Leukotrienes (SRS-A)", value: "b" },
                    { text: "Heparin", value: "c" },
                    { text: "Proteases (Tryptase)", value: "d" },
                    { text: "Eosinophil chemotactic factor (ECF-A)", value: "e" }
                ],
                correct: "b",
                explanation: "Primary mediators (Histamine, Heparin, Proteases, ECF-A) are pre-formed and stored in mast cell granules. Secondary mediators, like Leukotrienes (SRS-A) and Prostaglandins, are synthesized from the cell membrane (arachidonic acid) ONLY AFTER the cell is activated."
            },
            {
                question: "Which of the following patient presentations is INCORRECTLY matched with its most probable iatrogenic or pathogenic cause?",
                options: [
                    { text: "A 7-year-old with developmental enamel hypoplasia and pulp obliteration; chronic renal failure.", value: "a" },
                    { text: "A 50-year-old with painful, ulcerative oral mucositis 7 days post-infusion; Methotrexate therapy.", value: "b" },
                    { text: "A 60-year-old with asymptomatic, exposed bone in a 10-week-old extraction site; Alendronate therapy.", value: "c" },
                    { text: "A 45-year-old with generalized gingival hyperplasia; Cyclosporine therapy.", value: "d" },
                    { text: "A 55-year-old with a positive tuberculin skin test (PPD); IgE-mediated degranulation.", value: "e" }
                ],
                correct: "e",
                explanation: "The tuberculin skin test (PPD) is a quintessential example of a Type IV (delayed-type, cell-mediated) hypersensitivity. IgE-mediated degranulation corresponds to Type I (immediate/allergic) hypersensitivity. This match is incorrect."
            }
        ];


        // --- Global Variables ---
        let currentQuestionIndex = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let score = 0;

        // --- DOM References ---
        const quizContainer = document.querySelector('.quiz-container');
        const header = document.querySelector('header');
        const progressText = document.getElementById('progressText');
        const quizBody = document.getElementById('quizBody');
        const nextBtn = document.getElementById('nextBtn');
        const resultsPage = document.getElementById('resultsPage');
        const quizFooter = document.querySelector('.quiz-footer');

        // --- Function to Load Question ---
        function loadQuestion(index) {
            // Clear previous content
            quizBody.innerHTML = '';
            
            const questionData = quizData[index];

            // Create question title
            const questionTitle = document.createElement('p');
            questionTitle.className = 'question-title';
            questionTitle.textContent = questionData.question;
            quizBody.appendChild(questionTitle);

            // Create options container
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options';
            
            // Create radio button options
            questionData.options.forEach(option => {
                const label = document.createElement('label');
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'q'; // All options for one question have the same name
                radio.value = option.value;
                
                // Re-select answer if user was to go back
                if (userAnswers[index] === option.value) {
                    radio.checked = true;
                }
                
                const span = document.createElement('span');
                span.textContent = option.text;
                
                label.appendChild(radio);
                label.appendChild(span);
                optionsDiv.appendChild(label);
            });

            quizBody.appendChild(optionsDiv);
            
            // Update progress text
            progressText.textContent = `Question ${index + 1} of ${quizData.length}`;

            // Change button text on the last question
            if (index === quizData.length - 1) {
                nextBtn.textContent = 'View Results';
            } else {
                nextBtn.textContent = 'Next';
            }
        }

        // --- Function for "Next" Button ---
        function handleNextButton() {
            // 1. Validate that an option was selected
            const selectedOption = document.querySelector('input[name="q"]:checked');
            if (!selectedOption) {
                alert('Please select an answer before continuing.');
                return; // Stop the function
            }

            // 2. Save the answer
            userAnswers[currentQuestionIndex] = selectedOption.value;

            // 3. Advance to the next question or show results
            currentQuestionIndex++;

            if (currentQuestionIndex < quizData.length) {
                // If there are more questions
                loadQuestion(currentQuestionIndex);
            } else {
                // If the quiz is finished
                showResults();
            }
        }

        // --- Function to Show Results ---
        function showResults() {
            // 1. Hide the quiz body and button
            quizBody.classList.add('hidden');
            quizFooter.classList.add('hidden');
            header.classList.add('hidden'); // Also hide the original header

            // 2. Calculate the score
            score = 0;
            let resultsHTML = ''; // String to build the results HTML

            quizData.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === question.correct;
                
                if (isCorrect) {
                    score++;
                }

                // Find the text for the user's answer and the correct answer
                const userAnswerText = question.options.find(opt => opt.value === userAnswer)?.text || "Not answered";
                const correctAnswerText = question.options.find(opt => opt.value === question.correct).text;

                // Build the HTML for this result item
                resultsHTML += `
                    <div class="result-item ${isCorrect ? 'correct' : 'incorrect'}">
                        <h3>Question ${index + 1}: ${isCorrect ? 'Correct' : 'Incorrect'}</h3>
                        <p class="question-title">${question.question}</p>
                        <p><strong>Your answer:</strong> ${userAnswerText}</p>
                        ${!isCorrect ? `<p class="answer-key"><strong>Correct answer:</strong> ${correctAnswerText}</p>` : ''}
                        <div class="explanation">
                            <strong>Explanation:</strong> ${question.explanation}
                        </div>
                    </div>
                `;
            });

            // 3. Prepare the final results HTML (with score summary)
            const finalResultsHTML = `
                <div class="score-summary">
                    <h1>Final Results</h1>
                    <h2>${score} / ${quizData.length}</h2>
                </div>
                ${resultsHTML}
            `;

            // 4. Display the results
            resultsPage.innerHTML = finalResultsHTML;
            resultsPage.classList.remove('hidden');

            // Scroll to the top of the results
            quizContainer.scrollIntoView({ behavior: 'smooth' });
        }


        // --- Event Listeners ---
        
        // Load the first question when the page is ready
        document.addEventListener('DOMContentLoaded', () => {
            loadQuestion(0);
        });

        // Assign the function to the "Next" button
        nextBtn.addEventListener('click', handleNextButton);

    </script>

</body>
</html>
